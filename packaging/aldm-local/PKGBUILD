#! /usr/bin/env sh

# Maintainer: shivanandvp <shivanandvp.oss@gmail.com, shivanandvp@rebornos.org>

PACKAGE_NAME_STUB="aldm"
provides=("$PACKAGE_NAME_STUB")
depends=('pacman' 'pciutils' 'usbutils' 'gtk4')
arch=('x86_64')
pkgdesc='A driver manager for Arch Linux.'
url="https://github.com/shivanandvp/$PACKAGE_NAME_STUB"
license=('MPL-2.0') 

# -------- # 
# Specific #
# -------- #
PKGVER_STUB=0.0.1
pkgver=0.0.1.2023_08_28T20_43_50_05_00
pkgrel=1
pkgname="$PACKAGE_NAME_STUB-local"
conflicts=("$PACKAGE_NAME_STUB" "$PACKAGE_NAME_STUB-git")
makedepends=('cargo')
source=()
sha256sums=()
prepare() {
    export PROJECT_DIRECTORY="$(dirname -- "$(dirname -- "$(dirname -- "$(pwd)")")")"
}
pkgver() {
    echo "$PKGVER_STUB.$(date -Is | tr '\:\-\+\;' '_')"
}
# -------- #

RESOURCE_DIRECTORY="$PROJECT_DIRECTORY/packaging/resources"
BUILD_DIRECTORY="$PROJECT_DIRECTORY/target"
build() {   
    (   cd "$PROJECT_DIRECTORY" \
        && RUSTUP_TOOLCHAIN=stable \
        cargo build \
            --release \
            --all-features \
            --target-dir="target"
    )
}
package() {
    # To bypass makepkg's dependency check during build-time
    optdepends+=("$PACKAGE_NAME_STUB-db")
    install -Dm644 "$PROJECT_DIRECTORY/LICENSE" "$pkgdir/usr/share/licenses/$PACKAGE_NAME_STUB/LICENSE"
    install -Dm755 "$PROJECT_DIRECTORY/target/release/$PACKAGE_NAME_STUB" "$pkgdir/usr/bin/$PACKAGE_NAME_STUB"
    install -Dm755 "$PROJECT_DIRECTORY/target/release/$PACKAGE_NAME_STUB-gui" "$pkgdir/usr/bin/$PACKAGE_NAME_STUB-gui"
}

